{% extends "base.html" %}
{% block title %}| Pessoa{%endblock%}

{% block style %}
  <style>
    label.required:after {
      content: '*';
      color: red;
    }
  </style>
{% endblock style %}

{% block content %}
<div class="container">
  <h4>Adicionar Pessoas</h4>
  <div class="accordion" id="accordionExample">
    <div class="card">
      <div class="card-header" id="headingTwo">
        <h2 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseTwo" aria-expanded="false" aria-controls="collapseTwo">
            <span><i class="fa fa-chevron-up"></i></span>
            Pessoa
          </button>
        </h2>
      </div>
      <div id="collapseTwo" class="collapse show" aria-labelledby="headingTwo" data-parent="#accordionExample">
        <div class="card-body">
          <div>
            <form action="" method="POST">

              <div class="form-group">
                <label for="" class="control-label required">Nome</label>
                <input id="id_nome" name="nome" v-model="pessoa.nome" class="form-control" required type="text" />
              </div>

              <div class="form-group">
                <label for="" class="control-label required">Sobrenome</label>
                <input id="id_sobrenome" name="sobrenome" v-model="pessoa.sobrenome" class="form-control" required type="text" />
              </div>

              <div class="form-group">
                <label for="" class="control-label">CPF</label>
                <input id="id_cpf" name="cpf" v-model="pessoa.cpf" class="form-control" type="text" />
              </div>

            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header" id="headingThree">
        <h2 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
            <span><i class="fa fa-chevron-down"></i></span>
            Infrações
          </button>
        </h2>
      </div>
      <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
        <div class="card-body">
          <div>
            <form action="" method="POST">

              <div class="form-row" v-for="infracao in infracoes">

                <div class="form-group col-md-3">
                  <label for="inputState">Natureza</label>
                  <select id="inputState" class="form-control" v-model="infracao.natureza">
                    <option selected value="">---</option>
                    <option v-for="natureza in naturezas" :key="natureza.value" :value="natureza.value">${ natureza.text }</option>
                  </select>
                </div>

                <div class="form-group col-md-3">
                  <label for="inputState">Qualificação</label>
                  <select id="inputState" class="form-control" v-model="infracao.qualificacao">
                    <option selected value="">---</option>
                    <option v-for="qualificacao in qualificacoes" :key="qualificacao.value" :value="qualificacao.value">${ qualificacao.text }</option>
                  </select>
                </div>

                <div class="form-group col-md-3">
                  <label for="inputState">Arma</label>
                  <select id="inputState" class="form-control" v-model="infracao.arma">
                    <option selected value="">---</option>
                    <option v-for="arma in armas" :key="arma.value" :value="arma.value">${ arma.text }</option>
                  </select>
                </div>

                <div class="form-group col-md-3">
                  <label for="inputState">Status</label>
                  <select id="inputState" class="form-control" v-model="infracao.status">
                    <option selected value="">---</option>
                    <option v-for="status in status" :key="status.value" :value="status.value">${ status.text }</option>
                  </select>
                </div>

              </div> <!-- form-row -->

              <button type="button" class="btn btn-primary" @click="naturezaAdd">
                <i class="fa fa-plus"></i> Adicionar
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>

    <div class="card">
      <div class="card-header" id="headingThree">
        <h2 class="mb-0">
          <button class="btn btn-link collapsed" type="button" data-toggle="collapse" data-target="#collapseThree" aria-expanded="false" aria-controls="collapseThree">
            <span><i class="fa fa-chevron-down"></i></span>
            Veículos
          </button>
        </h2>
      </div>
      <div id="collapseThree" class="collapse" aria-labelledby="headingThree" data-parent="#accordionExample">
        <div class="card-body">
          <div>
            <form action="" method="POST">

              <div class="form-row" v-for="veiculo in veiculos">

                <div class="form-group col-md-4">
                  <label for="inputState">Veículo</label>
                  <select id="inputState" class="form-control" v-model="veiculo.carro">
                    <option selected value="">---</option>
                    <option v-for="carro in carros" :key="carro.value" :value="carro.value">${ carro.text }</option>
                  </select>
                </div>

              </div> <!-- form-row -->

              <button type="button" class="btn btn-primary" @click="veiculoAdd">
                <i class="fa fa-plus"></i> Adicionar
              </button>
            </form>
          </div>
        </div>
      </div>
    </div>


  </div>

  <div class="float-right mt-3">
    <button class="btn btn-lg btn-success" @click="salvar">Salvar</button>
  </div>

</div>
{% endblock content %}

{% block vuejs %}
  <script>
    axios.defaults.xsrfHeaderName = 'X-CSRFToken'
    axios.defaults.xsrfCookieName = 'csrftoken'

    const endpoint = 'http://localhost:8000/'

    var app = new Vue({
      el: '#app',
      delimiters: ['${', '}'],
      data: {
        pessoa: {
          'nome': '',
          'sobrenome': '',
          'cpf': '',
        },
        pessoas: [],
        naturezas: [],
        qualificacoes: [],
        armas: [],
        status: [],
        infracoes: [
          {
            'natureza': '',
            'qualificacao': '',
            'arma': '',
            'status': '',
          }
        ],
        carros: [],
        veiculos: [
          {
            'carro': ''
          }
        ]
      },
      created() {
        axios.get(endpoint + 'api/naturezas/')
        .then(response => {
          this.naturezas = response.data.data;
        })

        axios.get(endpoint + 'api/qualificacoes/')
        .then(response => {
          this.qualificacoes = response.data.data;
        })

        axios.get(endpoint + 'api/armas/')
        .then(response => {
          this.armas = response.data.data;
        })

        axios.get(endpoint + 'api/status/')
        .then(response => {
          this.status = response.data.data;
        })

        axios.get(endpoint + 'api/veiculos/')
        .then(response => {
          this.carros = response.data.data;
        })

      },
      methods: {
        naturezaAdd() {
          this.infracoes.push(
            {
              'natureza': '',
              'qualificacao': '',
              'arma': '',
              'status': '',
            }
          )
        },
        veiculoAdd() {
          this.veiculos.push(
            {
              'carro': '',
            }
          )
        },
        salvar() {
          let bodyFormData = new FormData();
          bodyFormData.append('pessoa', JSON.stringify(this.pessoa));
          bodyFormData.append('infracoes', JSON.stringify(this.infracoes));
          bodyFormData.append('veiculos', JSON.stringify(this.veiculos));
          axios.post(endpoint + 'api/pessoas/add/', bodyFormData)
            .then(response => {
              console.log(response.data);
            })
        }
      }
    });
  </script>
{% endblock vuejs %}